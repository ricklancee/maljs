"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var MALjs=function(){function e(t,n){var r=this;_classCallCheck(this,e);if(!t||!n){throw new Error("MALjs requires a myanimelist.net username and password.")}this._user=t;this._password=n;this._parser=new DOMParser;this.anime={search:function e(t){return r.search(t,"anime")},list:function e(){return r.list("anime")},add:function e(t,n){return r.add(t,n,"anime")},update:function e(t,n){return r.update(t,n,"anime")},delete:function e(t,n){return r.delete(t,"anime")}};this.manga={search:function e(t){return r.search(t,"manga")},list:function e(){return r.list("manga")},add:function e(t,n){return r.add(t,n,"manga")},update:function e(t,n){return r.update(t,n,"manga")},delete:function e(t,n){return r.delete(t,"manga")}}}_createClass(e,[{key:"search",value:function e(t,n){this._checkType(n);return this._get("http://myanimelist.net/api/"+n+"/search.xml?q="+t)}},{key:"list",value:function e(t){this._checkType(t);return this._get("http://myanimelist.net/malappinfo.php?u="+this._user+"&status=all&type="+t)}},{key:"add",value:function e(t,n,r){this._checkType(r);if(!n.entry){n={entry:n}}return this._post("http://myanimelist.net/api/"+r+"list/add/"+t+".xml",n)}},{key:"update",value:function e(t,n,r){this._checkType(r);if(!n.entry){n={entry:n}}return this._post("http://myanimelist.net/api/"+r+"list/update/"+t+".xml",n)}},{key:"delete",value:function e(t,n){this._checkType(n);return this._post("http://myanimelist.net/api/"+n+"list/delete/"+t+".xml")}},{key:"verifyCredentials",value:function e(){return this._get("http://myanimelist.net/api/account/verify_credentials.xml")}},{key:"_checkType",value:function e(t){if(t!=="anime"&&t!=="manga"){throw new Error("Only allowed types are anime and manga. incorrect type: "+t+" given.")}}},{key:"_parseXml",value:function e(t){var n=this._parser.parseFromString(t,"text/xml");if(n.documentElement.nodeName==="html"){return false}return n}},{key:"_toJson",value:function e(t){var n=t.childNodes;var r={};for(var a=0;a<n.length;a++){var i=n[a];r[i.nodeName]=[];var s=i.childNodes;for(var o=0;o<s.length;o++){var u=s[o];var l={};if(u.nodeName==="#text")continue;var c=u.childNodes;for(var f=0;f<c.length;f++){var d=c[f];if(d.nodeName==="#text")continue;var p=d.innerHTML;if(d.nodeName==="id"||d.nodeName==="episodes"){p=parseInt(p,10)}l[d.nodeName]=p}r[i.nodeName].push(l)}}return r}},{key:"_toXml",value:function e(t){var n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>';function r(e){for(var t in e){if(e.hasOwnProperty(t)){if(e[t].constructor==Object){n+="<"+t+">";r(e[t]);n+="</"+t+">"}else{n+="<"+t+">"+e[t]+"</"+t+">"}}}}r(t);return n}},{key:"_get",value:function e(t){var n=this;return new Promise(function(e,r){var a=new XMLHttpRequest;a.open("GET",t,true,n._user,n._password);a.onload=function(){if(a.status===200){var t=a.response;var i=n._parseXml(t);if(i){e(n._toJson(i))}else{r("Failed to parse xml")}}else{r("request failed")}};a.onerror=function(){r("request failed")};a.send()})}},{key:"_post",value:function e(t){var n=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new Promise(function(e,a){var i=new XMLHttpRequest;i.open("POST",t,true,n._user,n._password);i.setRequestHeader("Content-type","application/x-www-form-urlencoded");i.onload=function(){if(i.status===200||i.status===201){e(i.response)}else{a(i.response)}};i.onerror=function(){a("request failed")};if(r){var s=n._toXml(r);i.send("data="+s)}else{i.send()}})}}]);return e}();window.MALjs=MALjs;