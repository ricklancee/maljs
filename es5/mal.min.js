"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var MALjs=function(){function e(t,n){_classCallCheck(this,e);this.user=t;this.password=n;if(!this.user||!this.password){throw new Error("MALjs requires a myanimelist.net username and password.")}}_createClass(e,[{key:"search",value:function e(t){var n=this;return new Promise(function(e,r){n._get("http://myanimelist.net/api/anime/search.xml?q="+t).then(n._parseXml).then(e).catch(r)})}},{key:"list",value:function e(){var t=this;return new Promise(function(e,n){t._get("http://myanimelist.net/malappinfo.php?u="+t.user+"&status=all&type=anime").then(t._parseXml).then(e).catch(n)})}},{key:"add",value:function e(t,n){var r=this;return new Promise(function(e,i){if(!n.entry){n={entry:n}}r._post("http://myanimelist.net/api/animelist/add/"+t+".xml",n).then(e).catch(i)})}},{key:"update",value:function e(t,n){var r=this;return new Promise(function(e,i){if(!n.entry){n={entry:n}}r._post("http://myanimelist.net/api/animelist/update/"+t+".xml",n).then(e).catch(i)})}},{key:"delete",value:function e(t){var n=this;return new Promise(function(e,r){n._post("http://myanimelist.net/api/animelist/delete/"+t+".xml").then(e).catch(r)})}},{key:"verifyCredentials",value:function e(){var t=this;return new Promise(function(e,n){t._get("http://myanimelist.net/api/account/verify_credentials.xml").then(t._parseXml).then(e).catch(n)})}},{key:"_parseXml",value:function e(t){return new Promise(function(e,n){parseString(t,{explicitArray:false},function(t,r){if(r)e(r);if(t)n(t)})})}},{key:"_toXml",value:function e(t){var n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>';function r(e){for(var t in e){if(e.hasOwnProperty(t)){if(e[t].constructor==Object){n+="<"+t+">";r(e[t]);n+="</"+t+">"}else{n+="<"+t+">"+e[t]+"</"+t+">"}}}}r(t);return n}},{key:"_get",value:function e(t){var n=this;return new Promise(function(e,r){var i=new XMLHttpRequest;i.open("GET",t,true,n.user,n.password);i.onload=function(){if(i.status===200){e(i.response)}else{r("request failed")}};i.onerror=function(){r("request failed")};i.send()})}},{key:"_post",value:function e(t){var n=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new Promise(function(e,i){var a=new XMLHttpRequest;a.open("POST",t,true,n.user,n.password);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onload=function(){if(a.status===200||a.status===201){e(a.response)}else{i("request failed")}};a.onerror=function(){i("request failed")};if(r){var s=n._toXml(r);a.send("data="+s)}else{a.send()}})}}]);return e}();window.MALjs=MALjs;